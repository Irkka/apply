#!/bin/bash
BASHLIB_PATH="${HOME}/.local/lib:$(readlink -m ${BASH_SOURCE}/../../lib)"

LOADED_BY_SQUIRE=()
function load() {
  library="${1}.sh"

  if [[ -f $library ]]; then
    source $library
    echo "${library} loaded"
    return 0
  fi

  echo "Library $library doesn't exist"
  return 1
}

# Squire functionality integrated
function require() {
  library_directories=$(echo $BASHLIB_PATH|tr ':', ' ')
  for library_directory in $library_directories ; do
    library=$(readlink -f "${library_directory%%\/}/${1%%\.*}")
    if load $library ; then
      break
    fi
  done
}

function require_relative() {
  relative_root_directory="${1%/*}"
  library_relative_path="${2}"
  library=$(readlink -f "${relative_root_directory}/${library_relative_path}")
  load "${library}"
}

require 'apply'

apply_dispatch "$@"
dispatcher_dump
